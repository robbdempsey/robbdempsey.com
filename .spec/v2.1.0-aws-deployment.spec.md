# AWS Deployment Plan - DEV Stage

## Overview
This spec outlines the implementation of a staged deployment system for the robbdempsey.com website using AWS infrastructure. The focus is on the DEV environment, with plans for future expansion to PROD. The deployment will be automated via GitHub Actions, ensuring secure and reliable releases.

## AWS Resources for DEV Stage

### 1. S3 Bucket
- **Purpose**: Static website hosting for the built Next.js application
- **Configuration**:
  - Bucket name: `robbdempsey-dev-site` (follow AWS naming conventions)
  - Region: us-east-1 (or preferred region)
  - Public access: Enabled for static website hosting
  - Versioning: Enabled for rollback capabilities
  - Server-side encryption: AES256
- **Bucket Policy**: Allow CloudFront to access objects

### 2. CloudFront Distribution
- **Purpose**: CDN and HTTPS termination for the DEV environment
- **Configuration**:
  - Origin: S3 bucket (`robbdempsey-dev-site`)
  - Origin Access Identity (OAI): Created and attached to S3 bucket
  - Alternate Domain Names (CNAMEs): `dev.robbdempsey.com`
  - SSL Certificate: ACM certificate for `dev.robbdempsey.com`
  - Price Class: Use-Case-Optimized (or appropriate for DEV)
  - Default Root Object: `index.html`
  - Error Pages: Custom 404 and 500 pages
  - Invalidation: Automated via GitHub Actions after deployment

### 3. Route 53 Hosted Zone
- **Purpose**: DNS management for the domain
- **Configuration**:
  - Domain: `robbdempsey.com` (assuming already exists)
  - Record: CNAME for `dev.robbdempsey.com` pointing to CloudFront distribution

### 4. AWS Certificate Manager (ACM)
- **Purpose**: SSL/TLS certificates for HTTPS
- **Configuration**:
  - Certificate for `dev.robbdempsey.com`
  - Validation: DNS validation using Route 53

### 5. IAM Roles and Policies
- **Purpose**: Secure access for GitHub Actions deployment
- **Configuration**:
  - OIDC Provider: Configure GitHub as OIDC provider in IAM
  - IAM Role: `GitHubActionsDeployRole` with permissions for:
    - S3: PutObject, DeleteObject, ListBucket on dev bucket
    - CloudFront: CreateInvalidation on dev distribution
  - Trust Policy: Allow GitHub repository `robbdempsey/robbdempsey.com` to assume the role

## GitHub Workflow Plan

### Workflow Structure
- **File**: `.github/workflows/deploy-dev.yml`
- **Triggers**:
  - `push` to `develop` branch
  - `pull_request` targeting `develop` branch (for validation)
  - `workflow_dispatch` for manual deployments

### Jobs
1. **Build**
   - Runs on: `ubuntu-latest`
   - Steps:
     - Checkout code
     - Setup Node.js (version from package.json)
     - Install dependencies
     - Run linting
     - Build application (`npm run build`)
     - Export static site (`npm run export` if needed)
     - Upload build artifacts

2. **Deploy to DEV**
   - Runs on: `ubuntu-latest`
   - Needs: Build job
   - Environment: dev
   - Steps:
     - Download build artifacts
     - Configure AWS credentials (OIDC)
     - Sync files to S3 bucket
     - Create CloudFront invalidation
     - Health check (optional)

### Security Considerations
- Use OIDC for AWS authentication (no long-lived credentials)
- Least privilege IAM policies
- Environment protection rules for DEV deployments

## Secrets Management

### GitHub Secrets Storage
All sensitive information will be stored as GitHub Secrets at the repository level:

1. **AWS Account Configuration**
   - No secrets needed for OIDC approach
   - AWS Region stored as: `AWS_REGION` (plaintext, not sensitive)

2. **OIDC Setup Process**
   - Create OIDC provider in AWS IAM pointing to GitHub
   - Create IAM role with trust policy allowing the repository to assume it
   - Store the IAM Role ARN as: `AWS_ROLE_ARN_DEV`

3. **CloudFront Configuration**
   - Distribution ID stored as: `CLOUDFRONT_DISTRIBUTION_ID_DEV`

4. **S3 Configuration**
   - Bucket name stored as: `S3_BUCKET_NAME_DEV`

### Security Best Practices
- Secrets are encrypted at rest and only decrypted during workflow execution
- Access is limited to the specific repository
- No secrets are logged or exposed in workflow outputs
- Regular rotation of any future long-lived credentials (though OIDC eliminates this need)

### Setup Instructions
1. Configure AWS OIDC provider and IAM role
2. Add secrets to GitHub repository settings
3. Test deployment with a manual workflow dispatch
4. Verify DEV environment accessibility

## Future Considerations
- PROD environment will mirror DEV but with additional security (manual approvals, different domain)
- Implement blue-green deployments for zero-downtime updates
- Add monitoring and alerting for deployment failures
- Consider using AWS Amplify for simplified Next.js deployments (alternative approach)