# v2.1.0-deploy-dev-manual-branch-selection.spec.md

## Feature Overview

Enhance the deploy-dev workflow to allow manual deployment with branch selection and automatic deployment on merge to main.

## Current State

- The deploy-dev.yml workflow currently triggers on pull_request to main and workflow_dispatch.
- It builds the application and deploys only if the event is push or workflow_dispatch (which seems inconsistent).
- No branch selection for manual deployments.

## Proposed Changes

### Workflow Modifications

1. **Update Triggers:**
   - Change `on` to `push: branches: [main]` for automatic deployment on merge.
   - Keep `workflow_dispatch` for manual deployments.
   - Add `inputs` to `workflow_dispatch` for branch selection.

2. **Add Branch Input for Manual Deploy:**
   - In `workflow_dispatch`, add an input field for selecting the branch to deploy.

3. **Adjust Checkout Step:**
   - For manual dispatch, checkout the selected branch.
   - For push to main, checkout main.

4. **Remove Inconsistent If Condition:**
   - The current `if: github.event_name == 'push' || github.event_name == 'workflow_dispatch'` in deploy-to-dev job is confusing. Simplify to always deploy after build succeeds.

5. **Security and Permissions:**
   - Ensure permissions are set to least privilege.
   - Use OIDC for AWS credentials if possible.

### Acceptance Criteria

- [ ] Manual deployment: Developer can navigate to Actions, select "Deploy to DEV", choose a branch from dropdown, and click deploy.
- [ ] Automatic deployment: When a PR is merged to main, the workflow runs automatically and deploys main.
- [ ] Build step works as before.
- [ ] Deployment uses the correct branch's code.

## Implementation Steps

1. Modify .github/workflows/deploy-dev.yml as described.
2. Test manual dispatch with different branches.
3. Test automatic deploy on merge to main.
4. Ensure no regressions in build or deploy process.

## Risks

- Branch selection might allow deploying untested branches; consider restricting to certain branches.
- Ensure AWS credentials and permissions are correct for dev environment.

## Dependencies

- None additional; uses existing AWS setup.